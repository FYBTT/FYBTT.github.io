I"Ğ<h1 id="ç®€ä»‹">ç®€ä»‹</h1>
<p>å¦‚ä¸‹å›¾å¯çŸ¥æ•´ä¸ªBlock I/Oæ¡†æ¶å¯ä»¥åˆ†ä¸ºä¸‰å±‚ï¼šVFSã€Blockå’ŒI/Oè®¾å¤‡é©±åŠ¨ã€‚
<img src="/img/perf/blockIOFramework.png" alt="blockIOFramework" />
Linuxå†…æ ¸ä¸­æä¾›äº†è·Ÿè¸ªBlockå±‚æ“ä½œçš„æ‰‹æ®µï¼Œå¯ä»¥é€šè¿‡blkè·Ÿè¸ªå™¨ã€æˆ–è€…ä½¿ç”¨blktrace/blkparse/bttå·¥å…·æŠ“å–åˆ†æã€æˆ–è€…ä½¿ç”¨blockç›¸å…³trace eventsè®°å½•ã€‚
blktraceçš„åŸç†</p>

<p>ä¸€ä¸ªI/Oè¯·æ±‚è¿›å…¥block layerä¹‹åï¼Œå¯èƒ½ä¼šç»å†ä¸‹é¢çš„è¿‡ç¨‹ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Remap: å¯èƒ½è¢«DM(Device Mapper)æˆ–MD(Multiple Device, Software RAID) remapåˆ°å…¶å®ƒè®¾å¤‡
Split: å¯èƒ½ä¼šå› ä¸ºI/Oè¯·æ±‚ä¸æ‰‡åŒºè¾¹ç•Œæœªå¯¹é½ã€æˆ–è€…sizeå¤ªå¤§è€Œè¢«åˆ†æ‹†(split)æˆå¤šä¸ªç‰©ç†I/O
Merge: å¯èƒ½ä¼šå› ä¸ºä¸å…¶å®ƒI/Oè¯·æ±‚çš„ç‰©ç†ä½ç½®ç›¸é‚»è€Œåˆå¹¶(merge)æˆä¸€ä¸ªI/O
è¢«IO Schedulerä¾ç…§è°ƒåº¦ç­–ç•¥å‘é€ç»™driver
è¢«driveræäº¤ç»™ç¡¬ä»¶ï¼Œç»è¿‡HBAã€ç”µç¼†ï¼ˆå…‰çº¤ã€ç½‘çº¿ç­‰ï¼‰ã€äº¤æ¢æœºï¼ˆSANæˆ–ç½‘ç»œï¼‰ã€æœ€ååˆ°è¾¾å­˜å‚¨è®¾å¤‡ï¼Œè®¾å¤‡å®ŒæˆIOè¯·æ±‚ä¹‹åå†æŠŠç»“æœå‘å›ã€‚
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Q-------&gt;G------------&gt;I---------&gt;M-------------------&gt;D-----------------------------&gt;C
 |-Q time-|-Insert time-|
 |--------- merge <span class="nb">time</span> <span class="nt">------------</span>|-merge with other IO|
 |----------------scheduler <span class="nb">time </span>time-------------------|---driver,adapter,storagetime--|
 
 |----------------------- await <span class="nb">time </span><span class="k">in </span>iostat output <span class="nt">----------------------------------</span>|
</code></pre></div></div>

:ET